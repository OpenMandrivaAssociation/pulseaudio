From 228d9e6824391105917f1ca2ab29060dfd1d7fb3 Mon Sep 17 00:00:00 2001
From: Colin Guthrie <cguthrie@mandriva.org>
Date: Thu, 1 Oct 2009 23:45:49 +0100
Subject: [PATCH 502/502] Apply startup customisation to new KDE module

---
 src/daemon/start-pulseaudio-kde.in | 16 +++++++++++++++-
 1 file changed, 15 insertions(+), 1 deletion(-)

diff --git a/src/daemon/start-pulseaudio-kde.in b/src/daemon/start-pulseaudio-kde.in
index c319e7d..84dc1db 100755
--- a/src/daemon/start-pulseaudio-kde.in
+++ b/src/daemon/start-pulseaudio-kde.in
@@ -21,10 +21,24 @@ set -e
 
 [ -z "$PULSE_SERVER" ]
 
-@PA_BINARY@ --start "$@"
+# Some Mandriva customisations
+CONFIG=/etc/sound/profiles/current/profile.conf
+
+PULSE_ARGS=" --log-target=syslog"
+[ -r "$CONFIG" ] && . $CONFIG
+
+if [ "$SOUNDPROFILE" != "pulse" ]; then
+  echo "Pulseaudio startup disabled due to soundprofile configuration" >&2
+else
+
+@PA_BINARY@ --start ${PULSE_ARGS} "$@"
+
+# End Mandriva customisations (except for the "fi" below)
 
 if [ x"$DISPLAY" != x ] ; then
 
     @PACTL_BINARY@ load-module module-device-manager "do_routing=1" > /dev/null
 
 fi
+
+fi
-- 
1.8.4

